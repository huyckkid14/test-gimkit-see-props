<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Compare Two Uploaded Images</title>
<style>
body{
  background:#111;
  color:white;
  font-family:Arial;
  text-align:center;
  padding:20px;
}
input{
  margin:10px;
}
img{
  max-width:200px;
  border:2px solid #444;
  margin:10px;
}
#result{
  font-size:20px;
  margin-top:20px;
}
</style>
</head>
<body>

<h2>Upload Two Images to Compare</h2>

<input type="file" id="img1Input" accept="image/*">
<input type="file" id="img2Input" accept="image/*">

<div>
  <img id="img1Preview">
  <img id="img2Preview">
</div>

<div id="result"></div>

<script>
const img1Input = document.getElementById("img1Input");
const img2Input = document.getElementById("img2Input");
const img1Preview = document.getElementById("img1Preview");
const img2Preview = document.getElementById("img2Preview");
const result = document.getElementById("result");

let img1Loaded = false;
let img2Loaded = false;

function getHash(img) {
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");
  canvas.width = 8;
  canvas.height = 8;

  ctx.drawImage(img, 0, 0, 8, 8);
  const data = ctx.getImageData(0,0,8,8).data;

  let gray = [];
  for(let i=0;i<data.length;i+=4){
    gray.push((data[i] + data[i+1] + data[i+2]) / 3);
  }

  const avg = gray.reduce((a,b)=>a+b) / gray.length;
  return gray.map(v => v > avg ? 1 : 0);
}

function hashDistance(h1, h2) {
  let diff = 0;
  for(let i=0;i<h1.length;i++){
    if(h1[i] !== h2[i]) diff++;
  }
  return diff;
}

function compareIfReady() {
  if (!img1Loaded || !img2Loaded) return;

  const hash1 = getHash(img1Preview);
  const hash2 = getHash(img2Preview);

  const distance = hashDistance(hash1, hash2);

  if(distance < 10){
    result.textContent = `Very similar (distance: ${distance})`;
    result.style.color = "lime";
  } 
  else if(distance < 20){
    result.textContent = `Somewhat similar (distance: ${distance})`;
    result.style.color = "orange";
  } 
  else {
    result.textContent = `Different images (distance: ${distance})`;
    result.style.color = "red";
  }
}

function loadImage(input, preview, flagSetter) {
  input.addEventListener("change", () => {
    const file = input.files[0];
    if(!file) return;

    const reader = new FileReader();
    reader.onload = () => {
      preview.src = reader.result;
      preview.onload = () => {
        flagSetter(true);
        compareIfReady();
      };
    };
    reader.readAsDataURL(file);
  });
}

loadImage(img1Input, img1Preview, v => img1Loaded = v);
loadImage(img2Input, img2Preview, v => img2Loaded = v);

</script>

</body>
</html>
